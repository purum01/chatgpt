<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.25.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.25.0/components/prism-python.min.js"></script> 
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.25.0/themes/prism.min.css" rel="stylesheet" />    

<button class="copy-btn" onclick="copyCode('source-code')">ğŸ“‹ Copy</button> 
<code id="source-code" class="language-python">
################# SmartWorkBot: í…ìŠ¤íŠ¸ ë¬¸ì„œ ê¸°ë°˜ ì±—ë´‡ #################

import streamlit as st
from langchain.text_splitter import CharacterTextSplitter
from langchain_openai import OpenAIEmbeddings, ChatOpenAI
from langchain_community.vectorstores import FAISS
from langchain.chains.question_answering import load_qa_chain

st.set_page_config(page_title="ğŸ“˜ SmartWorkBot - ë¬¸ì„œ ì±—ë´‡", layout="wide")
st.title("ğŸ¤– SmartWorkBot")
st.write("ì‚¬ë‚´ ì—…ë¬´ í…ìŠ¤íŠ¸ ë¬¸ì„œë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì§ˆë¬¸í•˜ê³  ë‹µë³€ì„ ë°›ì•„ë³´ì„¸ìš”.")

# ğŸ” API í‚¤ ì…ë ¥
openai_api_key = st.text_input("ğŸ”‘ OpenAI API í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš”", type="password")

# ğŸ“„ í…ìŠ¤íŠ¸ ë¬¸ì„œ ì—…ë¡œë“œ (.txt)
uploaded_file = st.file_uploader("ğŸ“ ì‚¬ë‚´ í…ìŠ¤íŠ¸ ë¬¸ì„œë¥¼ ì—…ë¡œë“œí•˜ì„¸ìš” (.txt)", type="txt")

# ì˜ˆì‹œ ì§ˆë¬¸
example_questions = [
    "ì—°ì°¨ëŠ” ë©°ì¹  ì „ì— ì‹ ì²­í•´ì•¼ í•˜ë‚˜ìš”?",
    "ì¬íƒê·¼ë¬´ëŠ” ì–¼ë§ˆë‚˜ ìì£¼ ê°€ëŠ¥í•œê°€ìš”?",
    "ì¶œì¥ë¹„ëŠ” ì–¸ì œê¹Œì§€ ì •ì‚°í•´ì•¼ í•˜ë‚˜ìš”?",
    "ë³´ì•ˆ êµìœ¡ì€ ê¼­ ë“¤ì–´ì•¼ í•˜ë‚˜ìš”?",
    "ê·¼ë¬´ ì‹œê°„ì€ ì–´ë–»ê²Œ ë˜ë‚˜ìš”?"
]

# âœ… ì„¸ì…˜ ìƒíƒœ ì´ˆê¸°í™”
if "selected_question" not in st.session_state:
    st.session_state.selected_question = ""

if uploaded_file and openai_api_key:
    with st.spinner("ğŸ“š ë¬¸ì„œ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤..."):

        # í…ìŠ¤íŠ¸ ì½ê¸°
        raw_text = uploaded_file.read().decode("utf-8")

        # í…ìŠ¤íŠ¸ ë¶„í• 
        text_splitter = CharacterTextSplitter(
            separator="\n",
            chunk_size=1000,
            chunk_overlap=200,
            length_function=len,
        )
        chunks = text_splitter.split_text(raw_text)

        # ì„ë² ë”© ìƒì„±
        embeddings = OpenAIEmbeddings(openai_api_key=openai_api_key)
        knowledge_base = FAISS.from_texts(chunks, embeddings)

    st.markdown("---")

    # ğŸ“Œ ì˜ˆì‹œ ì§ˆë¬¸ ë³´ê¸° í˜•ì‹ìœ¼ë¡œ í‘œì‹œ
    st.subheader("ğŸ“Œ ì˜ˆì‹œ ì§ˆë¬¸ ëª©ë¡ (í´ë¦­í•˜ë©´ ìë™ ì…ë ¥ë©ë‹ˆë‹¤)")
    cols = st.columns(2)
    for i, q in enumerate(example_questions):
        if cols[i % 2].button(f"ğŸ‘‰ {q}"):
            st.session_state.selected_question = q

    # ì§ˆë¬¸ ì…ë ¥ì°½
    question = st.text_input("ğŸ“¨ ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”",
                             value=st.session_state.selected_question,
                             key="question_input")

    if question:
        # ìœ ì‚¬ ë¬¸ì„œ ê²€ìƒ‰
        docs = knowledge_base.similarity_search(question)

        # GPT í˜¸ì¶œ
        llm = ChatOpenAI(openai_api_key=openai_api_key, temperature=0.2)
        chain = load_qa_chain(llm, chain_type="stuff")

        with st.spinner("ğŸ§  ë‹µë³€ ìƒì„± ì¤‘..."):
            response = chain.invoke({
                "input_documents": docs,
                "question": question
            })

            st.markdown("### ğŸ’¡ ë‹µë³€")
            st.write(response["output_text"])

        # ì„ íƒëœ ì§ˆë¬¸ ì´ˆê¸°í™”
        st.session_state.selected_question = ""

</code>                

<script>
    function copyCode(elementId) {
        // í•´ë‹¹ ìš”ì†Œì˜ í…ìŠ¤íŠ¸ë¥¼ ì„ íƒí•˜ê³  ë³µì‚¬í•©ë‹ˆë‹¤.
        var codeElement = document.getElementById(elementId);
        var range = document.createRange();
        range.selectNodeContents(codeElement);
        var selection = window.getSelection();
        selection.removeAllRanges();
        selection.addRange(range);
    
        try {
            document.execCommand('copy');
        } catch (err) {
            alert('ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
        }
        
        // ì„ íƒ í•´ì œ
        selection.removeAllRanges();
    }
</script>
