<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.25.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.25.0/components/prism-python.min.js"></script> 
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.25.0/themes/prism.min.css" rel="stylesheet" />    

<button class="copy-btn" onclick="copyCode('source-code')">ğŸ“‹ Copy</button>    
<code id="source-code" class="language-python">
#################  í…ìŠ¤íŠ¸ ìš”ì•½, í‚¤ì›Œë“œ ì¶”ì¶œ, ê°ì • ë¶„ì„, ì§ˆë¬¸ ìƒì„±, í† í”½ ë¶„ë¥˜ ###################

import streamlit as st
from openai import OpenAI
import os


os.getenv("OPENAI_API_KEY")

st.set_page_config(page_title="Steve Jobs Speech Lab", layout="wide")
st.title("ğŸ¤ Steve Jobs ì—°ì„¤ë¬¸ ë¶„ì„")
st.write("OpenAI API ê¸°ë°˜ ì‹¤ìŠµ ì˜ˆì œì…ë‹ˆë‹¤.")

# íŒŒì¼ ì—…ë¡œë“œ
uploaded_file = st.file_uploader("ğŸ“„ ì—°ì„¤ë¬¸ íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì„¸ìš” (.txt)", type=["txt"])

if uploaded_file:
    text = uploaded_file.read().decode("utf-8")

    task = st.selectbox(
        "ğŸ›  ë¶„ì„í•  ì‘ì—…ì„ ì„ íƒí•˜ì„¸ìš”",
        ["ìš”ì•½ ë° í•µì‹¬ ë©”ì‹œì§€", "ì§ˆë¬¸ ìƒì„±", "ê°ì • ë¶„ì„", "ë‚˜ë§Œì˜ ì—°ì„¤ë¬¸ ìƒì„±"]
    )

    if st.button("ğŸš€ ì‹¤í–‰"):
        with st.spinner("OpenAI API ìš”ì²­ ì¤‘..."):

            system_prompt = {
                "ìš”ì•½ ë° í•µì‹¬ ë©”ì‹œì§€": "You're an expert summarizer of motivational speeches.",
                "ì§ˆë¬¸ ìƒì„±": "You're a professional facilitator who creates discussion questions from speeches.",
                "ê°ì • ë¶„ì„": "You're a sentiment analyst who tags emotions for each paragraph.",
                "ë‚˜ë§Œì˜ ì—°ì„¤ë¬¸ ìƒì„±": "You're a speechwriter helping professionals craft inspirational speeches."
            }

            user_prompt = {
                "ìš”ì•½ ë° í•µì‹¬ ë©”ì‹œì§€": f"Summarize the following commencement speech. Extract 3 key messages for working professionals.\n\nSpeech:\n{text}",
                "ì§ˆë¬¸ ìƒì„±": f"Generate 5 discussion questions based on this speech. Make them reflective and relevant to mid-career professionals.\n\nSpeech:\n{text}",
                "ê°ì • ë¶„ì„": f"Analyze the emotional tone of each paragraph in the speech. Tag with emotions like hope, fear, joy, sadness, etc.\n\nSpeech:\n{text}",
                "ë‚˜ë§Œì˜ ì—°ì„¤ë¬¸ ìƒì„±": f"Write a motivational speech for professionals facing career burnout. Use Steve Jobs's tone and structure as inspiration.\n\nReference Speech:\n{text}"
            }

            # 1ì°¨ API í˜¸ì¶œ â€“ ì›ë¬¸ ë¶„ì„
            client = OpenAI()
            completion = client.chat.completions.create(
                model="gpt-4o",
                messages=[
                    {"role": "system", "content": system_prompt[task]},
                    {"role": "user", "content": user_prompt[task]}
                ],
                temperature=0.7
            )

            english_result = completion.choices[0].message.content

            # 2ì°¨ API í˜¸ì¶œ â€“ í•œê¸€ ë²ˆì—­
            translation_prompt = f"Please translate the following English text into natural Korean:\n\n{english_result}"
            translation_response = client.chat.completions.create(
                model="gpt-4o",
                messages=[
                    {"role": "system", "content": "You're a professional English to Korean translator."},
                    {"role": "user", "content": translation_prompt}
                ],
                temperature=0.5
            )

            korean_result = translation_response.choices[0].message.content

        st.success("âœ… ë¶„ì„ ë° ë²ˆì—­ ì™„ë£Œ!")

        tab1, tab2 = st.tabs(["ğŸ‡ºğŸ‡¸ English Output", "ğŸ‡°ğŸ‡· í•œê¸€ ë²ˆì—­"])

        with tab1:
            st.text_area("English Output", english_result, height=400)

        with tab2:
            st.text_area("í•œê¸€ ë²ˆì—­ ê²°ê³¼", korean_result, height=400)

else:
    st.warning("ğŸ’¡ ë¨¼ì € .txt íŒŒì¼ í˜•ì‹ì˜ ì—°ì„¤ë¬¸ì„ ì—…ë¡œë“œí•˜ì„¸ìš”.")
        
</code>
<script>
    function copyCode(elementId) {
        // í•´ë‹¹ ìš”ì†Œì˜ í…ìŠ¤íŠ¸ë¥¼ ì„ íƒí•˜ê³  ë³µì‚¬í•©ë‹ˆë‹¤.
        var codeElement = document.getElementById(elementId);
        var range = document.createRange();
        range.selectNodeContents(codeElement);
        var selection = window.getSelection();
        selection.removeAllRanges();
        selection.addRange(range);
    
        try {
            document.execCommand('copy');
        } catch (err) {
            alert('ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
        }
        
        // ì„ íƒ í•´ì œ
        selection.removeAllRanges();
    }
    </script>