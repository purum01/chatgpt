<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.25.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.25.0/components/prism-python.min.js"></script> 
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.25.0/themes/prism.min.css" rel="stylesheet" />    

<button class="copy-btn" onclick="copyCode('source-code')">ğŸ“‹ Copy</button>  
<code id="source-code" class="language-python">
#################  ì›¹í˜ì´ì§€ ìš”ì•½í•˜ê¸° ###################
"""
WebBaseLoader
https://python.langchain.com/docs/integrations/document_loaders/web_base/

WebBaseLoader ë¥¼ ì‚¬ìš©í•˜ì—¬ ì›¹í˜ì´ì§€ì—ì„œ ë³¸ë¬¸ í…ìŠ¤íŠ¸ë¥¼ ë¶ˆëŸ¬ì˜¤ê³ ,
RecursiveCharacterTextSplitter ë¡œ í…ìŠ¤íŠ¸ë¥¼ ë¶„í• í•œ í›„,
LangChainì˜ ìš”ì•½ ì²´ì¸ì„ ì‚¬ìš©í•˜ì—¬ ë‰´ìŠ¤ë¥¼ ìš”ì•½í•˜ëŠ” Streamlit ì•±.
"""
# https://edition.cnn.com/2025/07/15/politics/epstein-conspiracy-bondi-trump-analysis

import streamlit as st
from langchain_community.document_loaders import WebBaseLoader
from langchain.text_splitter import RecursiveCharacterTextSplitter
from langchain_openai import ChatOpenAI
from langchain_core.prompts import PromptTemplate
from langchain.chains.summarize import load_summarize_chain

st.set_page_config(page_title="ë‰´ìŠ¤ ìš”ì•½ê¸°")
st.title("ğŸ“° ë‰´ìŠ¤ ê¸°ì‚¬ ìš”ì•½ê¸°")

article_url = st.text_input("ë‰´ìŠ¤ ê¸°ì‚¬ URLì„ ì…ë ¥í•˜ì„¸ìš”")
api_key = st.text_input("OpenAI API í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš”", type="password")

if st.button("ìš”ì•½ ìƒì„±"):
    if not article_url or not api_key:
        st.error("URLê³¼ API í‚¤ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.")
    else:
        try:
            # ì›¹í˜ì´ì§€ì—ì„œ ë³¸ë¬¸ í…ìŠ¤íŠ¸ ë¶ˆëŸ¬ì˜¤ê¸°
            loader = WebBaseLoader(article_url)
            documents = loader.load()

            # í…ìŠ¤íŠ¸ ë¶„í• 
            splitter = RecursiveCharacterTextSplitter(chunk_size=3000, chunk_overlap=100)
            split_docs = splitter.split_documents(documents)

            # LLM ëª¨ë¸ ì„¤ì •
            llm = ChatOpenAI(
                temperature=0,
                openai_api_key=api_key,
                model="gpt-4o-mini",
                request_timeout=120
            )

            # ìš”ì•½ìš© í”„ë¡¬í”„íŠ¸ (ëª…ë ¹ë¬¸ìœ¼ë¡œ ìˆ˜ì •)
            map_prompt = PromptTemplate(
                template="ë‹¤ìŒ ë‰´ìŠ¤ ê¸°ì‚¬ ë‚´ìš©ì„ ê°„ê²°í•˜ê²Œ ìš”ì•½í•˜ë¼:\n```{text}```",
                input_variables=["text"]
            )
            combine_prompt = PromptTemplate(
                template="ë‹¤ìŒì€ ë‰´ìŠ¤ ê¸°ì‚¬ ì¡°ê°ë“¤ì˜ ìš”ì•½ì´ë‹¤:\n```{text}```\nì´ ë‚´ìš©ì„ 7~9ë¬¸ì¥ìœ¼ë¡œ ì¢…í•© ìš”ì•½í•˜ë¼.",
                input_variables=["text"]
            )

            # ì²´ì¸ êµ¬ì„± ë° ì‹¤í–‰
            chain = load_summarize_chain(
                llm,
                chain_type="map_reduce",
                map_prompt=map_prompt,
                combine_prompt=combine_prompt
            )
            summary = chain.invoke(split_docs)

            st.success("ìš”ì•½ ê²°ê³¼:")
            st.write(summary["output_text"])

        except Exception as e:
            st.error(f"ì˜¤ë¥˜ ë°œìƒ: {e}")

   
</code>
<script>
    function copyCode(elementId) {
        // í•´ë‹¹ ìš”ì†Œì˜ í…ìŠ¤íŠ¸ë¥¼ ì„ íƒí•˜ê³  ë³µì‚¬í•©ë‹ˆë‹¤.
        var codeElement = document.getElementById(elementId);
        var range = document.createRange();
        range.selectNodeContents(codeElement);
        var selection = window.getSelection();
        selection.removeAllRanges();
        selection.addRange(range);
    
        try {
            document.execCommand('copy');
        } catch (err) {
            alert('ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
        }
        
        // ì„ íƒ í•´ì œ
        selection.removeAllRanges();
    }
</script>